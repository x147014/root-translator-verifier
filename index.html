<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>词根翻译与校验工具</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 95%;
            max-width: 1600px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            padding: 30px;
            position: relative;
        }
        
        header {
            text-align: center;
            padding: 20px 0 30px;
            border-bottom: 2px solid #eaeaea;
            margin-bottom: 30px;
            position: relative;
        }
        
        h1 {
            font-size: 2.8rem;
            color: #1a2a6c;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            font-size: 1.3rem;
            color: #555;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .logo {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 2rem;
            color: #1a2a6c;
            background: rgba(26, 42, 108, 0.1);
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .help-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: #1a2a6c;
            background: rgba(26, 42, 108, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .help-icon:hover {
            background: rgba(26, 42, 108, 0.2);
            transform: scale(1.05);
        }
        
        .card-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 900px) {
            .card-container {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            padding: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #eaeaea;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
        }
        
        .card-title {
            font-size: 1.6rem;
            color: #1a2a6c;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-title i {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
            font-size: 1.1rem;
        }
        
        input[type="text"], input[type="file"] {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus, input[type="file"]:focus {
            border-color: #1a2a6c;
            background: #f0f7ff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 42, 108, 0.1);
        }
        
        input[type="file"] {
            border: 2px dashed #c0c0c0;
        }
        
        input[type="file"]:hover {
            border-color: #1a2a6c;
            background: #f0f7ff;
        }
        
        textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: #f9f9f9;
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        textarea:focus {
            border-color: #1a2a6c;
            background: #f0f7ff;
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 42, 108, 0.1);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            background: linear-gradient(135deg, #1a2a6c, #3a5fc9);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(26, 42, 108, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(26, 42, 108, 0.4);
        }
        
        .btn i {
            font-size: 1.2rem;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            box-shadow: 0 4px 10px rgba(39, 174, 96, 0.3);
        }
        
        .btn-success:hover {
            box-shadow: 0 6px 15px rgba(39, 174, 96, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #e67e22, #f39c12);
            box-shadow: 0 4px 10px rgba(230, 126, 34, 0.3);
        }
        
        .btn-warning:hover {
            box-shadow: 0 6px 15px rgba(230, 126, 34, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3498db, #2c3e50);
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        .btn-info:hover {
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            box-shadow: 0 4px 10px rgba(142, 68, 173, 0.3);
        }
        
        .btn-purple:hover {
            box-shadow: 0 6px 15px rgba(142, 68, 173, 0.4);
        }
        
        .btn-sm {
            padding: 10px 20px;
            font-size: 1rem;
        }
        
        .alert {
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            display: none;
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .alert-success {
            background: rgba(39, 174, 96, 0.15);
            border-left: 4px solid #27ae60;
            color: #27ae60;
        }
        
        .alert-danger {
            background: rgba(231, 76, 60, 0.15);
            border-left: 4px solid #e74c3c;
            color: #e74c3c;
        }
        
        .alert-info {
            background: rgba(52, 152, 219, 0.15);
            border-left: 4px solid #3498db;
            color: #3498db;
        }
        
        .result-section {
            margin-top: 30px;
            border-top: 2px solid #eaeaea;
            padding-top: 30px;
        }
        
        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .result-title {
            font-size: 1.8rem;
            color: #1a2a6c;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .pagination {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .pagination-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: #f0f0f0;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .pagination-btn:hover {
            background: #1a2a6c;
            color: white;
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .pagination-info {
            font-size: 1.1rem;
            font-weight: 500;
            color: #555;
            margin: 0 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border-radius: 15px;
            overflow: hidden;
        }
        
        th {
            background: linear-gradient(135deg, #1a2a6c, #3a5fc9);
            color: white;
            font-weight: 600;
            padding: 18px 15px;
            text-align: left;
            font-size: 1.2rem;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        tr:hover {
            background: #f0f7ff;
        }
        
        td {
            padding: 16px 15px;
            border-bottom: 1px solid #eaeaea;
            font-size: 1.1rem;
            color: #444;
        }
        
        .progress-container {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #1a2a6c, #3a5fc9);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            flex: 1;
            min-width: 200px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #eaeaea;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #1a2a6c;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 1.1rem;
            color: #777;
            text-align: center;
        }
        
        .auto-load-section {
            background: rgba(26, 42, 108, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 3px solid #1a2a6c;
        }
        
        .file-path-display {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin-top: 10px;
            word-break: break-all;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #1a2a6c;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 25px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px 10px 0 0;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .tab-btn.active {
            background: #1a2a6c;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .error-row {
            background-color: #ffebee !important;
        }
        
        .error-cell {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .success-row {
            background-color: #e8f5e9 !important;
        }
        
        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
        }
        
        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .instructions {
            background: rgba(26, 42, 108, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            border-left: 5px solid #1a2a6c;
        }
        
        .instructions h3 {
            margin-bottom: 15px;
            color: #1a2a6c;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            padding-left: 25px;
        }
        
        .instructions li {
            margin-bottom: 12px;
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .instructions li strong {
            color: #1a2a6c;
        }
        
        .highlight {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
            color: #777;
            font-size: 1.1rem;
        }
        
        .input-section {
            margin-top: 25px;
            padding-top: 25px;
            border-top: 1px dashed #eaeaea;
        }
        
        .input-hint {
            font-size: 0.9rem;
            color: #777;
            margin-top: 8px;
            font-style: italic;
        }
        
        .input-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .root-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px;
            align-items: end;
        }
        
        .root-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid #eaeaea;
            border-radius: 10px;
            padding: 10px;
        }
        
        .root-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
        }
        
        .root-item:last-child {
            border-bottom: none;
        }
        
        .root-chinese {
            font-weight: 600;
            color: #1a2a6c;
        }
        
        .root-english {
            color: #27ae60;
            font-family: monospace;
        }
        
        .added-root {
            background-color: #e8f5e9;
            border-left: 4px solid #2ecc71;
        }
        
        .root-actions {
            display: flex;
            gap: 10px;
        }
        
        .action-btn {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            border: none;
        }
        
        .edit-btn {
            background-color: #3498db;
            color: white;
        }
        
        .remove-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-column {
            flex: 1;
        }
        
        /* 新添加的样式 */
        .root-status-badge {
            position: absolute;
            top: 20px;
            right: 100px;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            z-index: 10;
        }
        
        .root-status-loaded {
            background-color: rgba(39, 174, 96, 0.2);
            color: #27ae60;
            border: 1px solid #27ae60;
        }
        
        .root-status-not-loaded {
            background-color: rgba(231, 76, 60, 0.2);
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .unmatched-root {
            color: #e74c3c;
            font-weight: bold;
            cursor: pointer;
            border-bottom: 1px dashed #e74c3c;
        }
        
        .invalid-root {
            color: #e74c3c;
            font-weight: bold;
            cursor: pointer;
            border-bottom: 1px dashed #e74c3c;
        }
        
        .form-group-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group-column {
            flex: 1;
        }
        
        .card-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        /* 优化翻译和校验标签页布局 */
        #translation-tab .card-container,
        #validation-tab .card-container {
          grid-template-columns: 1fr;
        }
        
        /* 结果部分两列布局 */
        .result-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 30px;
        }
        
        @media (max-width: 1200px) {
          .result-grid {
            grid-template-columns: 1fr;
          }
        }
        
        /* 表格紧凑样式 */
        .compact-table th,
        .compact-table td {
          padding: 12px 10px;
          font-size: 1rem;
        }
        
        /* 统计卡片样式 */
        .stat-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 20px;
          margin-bottom: 25px;
        }
        
        .stat-card {
          background: white;
          border-radius: 12px;
          padding: 18px;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
          text-align: center;
          transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
          transform: translateY(-3px);
        }
        
        .stat-card .value {
          font-size: 2.2rem;
          font-weight: 700;
          margin: 10px 0;
          color: #1a2a6c;
        }
        
        .stat-card .label {
          font-size: 1rem;
          color: #666;
        }
        
        .card-action-area {
          background: rgba(26, 42, 108, 0.03);
          border-radius: 12px;
          padding: 20px;
          margin-top: 20px;
        }
        
        .section-title {
          font-size: 1.4rem;
          color: #1a2a6c;
          margin-bottom: 20px;
          padding-bottom: 10px;
          border-bottom: 2px solid #f0f0f0;
          display: flex;
          align-items: center;
          gap: 10px;
        }
        
        .section-title i {
          color: #1a2a6c;
        }
        
        .result-summary {
          background: rgba(26, 42, 108, 0.05);
          border-radius: 12px;
          padding: 15px;
          margin-bottom: 20px;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }
        
        .result-summary .text {
          font-size: 1.1rem;
          font-weight: 500;
        }
        
        .result-summary .count {
          font-weight: 700;
          font-size: 1.3rem;
          color: #1a2a6c;
        }
        
        /* 优化卡片布局 */
        .card-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
          gap: 25px;
        }
        
        @media (max-width: 1000px) {
          .card-grid {
            grid-template-columns: 1fr;
          }
        }
        
        .action-card {
          background: white;
          border-radius: 15px;
          padding: 25px;
          box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
          transition: all 0.3s ease;
        }
        
        .action-card:hover {
          box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15);
          transform: translateY(-5px);
        }
        
        .card-header {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-bottom: 20px;
        }
        
        .card-header i {
          font-size: 1.8rem;
          color: #1a2a6c;
          background: rgba(26, 42, 108, 0.1);
          width: 50px;
          height: 50px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
        }
        
        .card-header h3 {
          font-size: 1.5rem;
          color: #1a2a6c;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-language"></i>
            </div>
            <div class="help-icon" id="help-icon">
                <i class="fas fa-question-circle"></i>
            </div>
            <div id="root-status-badge" class="root-status-badge root-status-not-loaded">
                <i class="fas fa-circle"></i> 词根库未加载
            </div>
            <h1>词根翻译与校验工具</h1>
            <p class="subtitle">基于词根库的中文智能翻译与表名/字段名校验系统</p>
        </header>
        
        <div class="tabs">
            <!-- 词根管理标签页移到第一个位置 -->
            <button class="tab-btn active" data-tab="management">词根管理</button>
            <button class="tab-btn" data-tab="translation">词根翻译</button>
            <button class="tab-btn" data-tab="validation">词根校验</button>
        </div>
        
        <!-- 词根管理功能 - 现在作为第一个标签页 -->
        <div id="management-tab" class="tab-content active">
            <div class="card-container">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-book"></i> 词根库管理</h2>
                    
                    <div class="auto-load-section">
                        <p><i class="fas fa-info-circle"></i> 请点击同一目录下的 root_dictionary.xlsx/.xls 文件进行词根加载</p>
                        <p>当前词根库状态：<span id="root-status">未加载</span></p>
                        <p>词根库版本：<span id="root-version">1.0.0</span></p>
                    </div>
                    
                    <div class="alert" id="root-alert"></div>
                    <button class="btn" id="retry-root-btn">
                        <i class="fas fa-sync-alt"></i> 重新加载词根库
                    </button>
                    <div class="progress-container" id="root-progress">
                        <div class="progress-bar" id="root-progress-bar"></div>
                    </div>
                    
                    <div class="stats" id="root-stats" style="display: none;">
                        <div class="stat-card">
                            <div class="stat-value" id="root-count">0</div>
                            <div class="stat-label">加载词根数量</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="max-length">0</div>
                            <div class="stat-label">最长词根长度</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="added-count">0</div>
                            <div class="stat-label">新增词根数量</div>
                        </div>
                    </div>
                    
                    <div class="card-section">
                        <h3 class="card-title"><i class="fas fa-file-import"></i> 导入词根库</h3>
                        <div class="form-row">
                            <div class="form-column">
                                <label for="import-file">选择词根库文件：</label>
                                <input type="file" id="import-file" accept=".xlsx,.xls">
                            </div>
                        </div>
                        <div class="alert" id="import-alert"></div>
                        <button class="btn btn-info" id="import-btn">
                            <i class="fas fa-file-import"></i> 导入词根库
                        </button>
                    </div>
                    
                    <div class="card-section">
                        <h3 class="card-title"><i class="fas fa-file-export"></i> 导出完整词根库</h3>
                        <p>导出包含原始词根和新增词根的完整词根库</p>
                        <button class="btn btn-success" id="export-full-root-btn">
                            <i class="fas fa-file-export"></i> 导出完整词根库
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-plus-circle"></i> 添加新词根</h2>
                    <div class="form-group">
                        <div class="root-form">
                            <div>
                                <label for="chinese-root">中文词根：</label>
                                <input type="text" id="chinese-root" placeholder="例如：人工智能">
                            </div>
                            <div>
                                <label for="english-root">英文词根：</label>
                                <input type="text" id="english-root" placeholder="例如：AI">
                            </div>
                            <div>
                                <button class="btn btn-purple" id="add-root-btn">
                                    <i class="fas fa-plus"></i> 添加词根
                                </button>
                            </div>
                        </div>
                        <div class="alert" id="add-root-alert"></div>
                    </div>
                    
                    <div class="card-section">
                        <h3 class="card-title"><i class="fas fa-list"></i> 新增词根列表</h3>
                        <div class="root-list" id="added-roots-list">
                            <div style="text-align: center; padding: 30px; color: #888;">
                                <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                                暂无新增词根
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-warning" id="export-added-roots">
                            <i class="fas fa-file-export"></i> 导出新增词根
                        </button>
                        <button class="btn btn-danger" id="clear-added-roots">
                            <i class="fas fa-trash"></i> 清空新增词根
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 词根翻译功能 -->
        <div id="translation-tab" class="tab-content">
            <div class="card-grid">
                <div class="action-card">
                    <div class="card-header">
                        <i class="fas fa-exchange-alt"></i>
                        <h3>翻译处理</h3>
                    </div>
                    
                    <div class="form-group-row">
                        <div class="form-group-column">
                            <div class="form-group">
                                <label for="translate-file"><i class="fas fa-file-import"></i> 上传待翻译Excel文件：</label>
                                <input type="file" id="translate-file" accept=".xls,.xlsx">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-warning" id="download-sample">
                                    <i class="fas fa-download"></i> 下载样例文件
                                </button>
                            </div>
                            <div class="alert" id="translate-alert"></div>
                            <button class="btn btn-success" id="translate-btn">
                                <i class="fas fa-cogs"></i> 开始翻译
                            </button>
                            <div class="progress-container" id="translate-progress">
                                <div class="progress-bar" id="translate-progress-bar"></div>
                            </div>
                        </div>
                        
                        <div class="form-group-column">
                            <div class="form-group">
                                <label for="text-input-translate"><i class="fas fa-keyboard"></i> 文本输入翻译：</label>
                                <textarea id="text-input-translate" placeholder="例如：人工智能,机器学习;自然语言处理 计算机视觉"></textarea>
                                <p class="input-hint">提示：支持多种分隔符，如逗号(,)、分号(;)、空格、换行等</p>
                            </div>
                            <div class="input-controls">
                                <button class="btn btn-info btn-sm" id="process-text-translate">
                                    <i class="fas fa-play"></i> 处理文本
                                </button>
                                <button class="btn btn-warning btn-sm" id="clear-text-translate">
                                    <i class="fas fa-trash-alt"></i> 清空
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="value" id="translated-count">0</div>
                            <div class="label">已翻译词条</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="unmatched-count">0</div>
                            <div class="label">未匹配词根</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="avg-length">0</div>
                            <div class="label">平均词根数</div>
                        </div>
                    </div>
                </div>
                
                <div class="action-card">
                    <div class="card-header">
                        <i class="fas fa-list-alt"></i>
                        <h3>翻译结果</h3>
                    </div>
                    
                    <div class="result-summary">
                        <div class="text">处理结果：<span class="count" id="result-count">0</span> 条记录</div>
                        <div class="pagination">
                            <button class="pagination-btn" id="prev-page" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span class="pagination-info" id="page-info">第 0 页 / 共 0 页</span>
                            <button class="pagination-btn" id="next-page" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert" id="result-alert"></div>
                    
                    <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                        <table class="compact-table">
                            <thead>
                                <tr>
                                    <th style="width: 30%;">原始中文</th>
                                    <th style="width: 35%;">拆分后中文</th>
                                    <th style="width: 35%;">英文转换</th>
                                </tr>
                            </thead>
                            <tbody id="preview-body">
                                <tr>
                                    <td colspan="3" style="text-align: center; padding: 50px; color: #888; font-size: 1.2rem;">
                                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                                        暂无翻译结果，请先上传文件或输入文本
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn" id="download-btn" disabled>
                            <i class="fas fa-file-download"></i> 下载完整结果
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 词根校验功能 -->
        <div id="validation-tab" class="tab-content">
            <div class="card-grid">
                <div class="action-card">
                    <div class="card-header">
                        <i class="fas fa-check-circle"></i>
                        <h3>校验处理</h3>
                    </div>
                    
                    <div class="form-group-row">
                        <div class="form-group-column">
                            <div class="form-group">
                                <label for="validate-file"><i class="fas fa-file-import"></i> 上传待校验Excel文件：</label>
                                <input type="file" id="validate-file" accept=".xls,.xlsx">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-info" id="download-validation-sample">
                                    <i class="fas fa-download"></i> 下载校验模板
                                </button>
                            </div>
                            <div class="alert" id="validation-alert"></div>
                            <button class="btn btn-success" id="validate-btn">
                                <i class="fas fa-check-double"></i> 开始校验
                            </button>
                            <div class="progress-container" id="validation-progress">
                                <div class="progress-bar" id="validation-progress-bar"></div>
                            </div>
                        </div>
                        
                        <div class="form-group-column">
                            <div class="form-group">
                                <label for="text-input-validate"><i class="fas fa-keyboard"></i> 文本输入校验：</label>
                                <textarea id="text-input-validate" placeholder="例如：T_EDW_EVT_ASSM_RKCT_CHK_RSLT, T_DDW_ASSM_F00_RKCT_CHK_RSLT"></textarea>
                                <p class="input-hint">提示：支持多种分隔符，如逗号(,)、分号(;)、空格、换行等</p>
                            </div>
                            <div class="input-controls">
                                <button class="btn btn-info btn-sm" id="process-text-validate">
                                    <i class="fas fa-play"></i> 处理文本
                                </button>
                                <button class="btn btn-warning btn-sm" id="clear-text-validate">
                                    <i class="fas fa-trash-alt"></i> 清空
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-grid">
                        <div class="stat-card">
                            <div class="value" id="table-error-count">0</div>
                            <div class="label">表名校验错误</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="field-error-count">0</div>
                            <div class="label">字段校验错误</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="invalid-root-count">0</div>
                            <div class="label">无效词根数</div>
                        </div>
                    </div>
                </div>
                
                <div class="action-card">
                    <div class="card-header">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>校验结果</h3>
                    </div>
                    
                    <div class="result-summary">
                        <div class="text">发现错误：<span class="count" id="error-count">0</span> 个</div>
                        <button class="btn" id="download-validation-results" disabled>
                            <i class="fas fa-file-download"></i> 下载校验结果
                        </button>
                    </div>
                    
                    <div class="alert" id="validation-result-alert"></div>
                    
                    <div class="section-title">
                        <i class="fas fa-table"></i>
                        <h4>表名检测结果</h4>
                    </div>
                    <div class="table-container" style="max-height: 300px; overflow-y: auto; margin-bottom: 25px;">
                        <table class="compact-table" id="table-validation-results">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">表名</th>
                                    <th style="width: 25%;">模式名</th>
                                    <th style="width: 25%;">错误原因</th>
                                    <th style="width: 25%;">无效词根</th>
                                </tr>
                            </thead>
                            <tbody id="table-preview-body">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 30px; color: #888; font-size: 1.1rem;">
                                        暂无表名检测结果
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="section-title">
                        <i class="fas fa-columns"></i>
                        <h4>字段检测结果</h4>
                    </div>
                    <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                        <table class="compact-table" id="field-validation-results">
                            <thead>
                                <tr>
                                    <th style="width: 25%;">表名</th>
                                    <th style="width: 25%;">字段名</th>
                                    <th style="width: 25%;">错误类型</th>
                                    <th style="width: 25%;">无效词根</th>
                                </tr>
                            </thead>
                            <tbody id="field-preview-body">
                                <tr>
                                    <td colspan="4" style="text-align: center; padding: 30px; color: #888; font-size: 1.1rem;">
                                        暂无字段检测结果
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>词根翻译与校验工具 &copy; 2023 | 基于词根库的中文智能处理系统</p>
        </div>
    </div>
    
    <!-- 帮助模态框 -->
    <div id="help-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            
            <div id="management-guide" class="instructions">
                <h3><i class="fas fa-info-circle"></i> 词根管理使用指南</h3>
                <ul>
                    <li><strong>词根库加载：</strong> 系统自动加载同一目录下的词根库文件</li>
                    <li><strong>添加词根：</strong> 在中文词根和英文词根输入框中输入内容，点击"添加词根"按钮</li>
                    <li><strong>词根校验：</strong> 系统会自动检查词根是否已存在，重复词根无法添加</li>
                    <li><strong>管理词根：</strong> 在新增词根列表中可删除已添加的词根</li>
                    <li><strong>导出功能：</strong> 可以导出新增词根或完整词根库</li>
                    <li><strong>导入功能：</strong> 支持从Excel文件导入词根库</li>
                    <li><strong>注意：</strong> 新增词根会保存在浏览器本地存储中，刷新页面不会丢失</li>
                </ul>
            </div>
            
            <div id="translation-guide" class="instructions">
                <h3><i class="fas fa-info-circle"></i> 翻译功能使用指南</h3>
                <ul>
                    <li><strong>步骤 1：</strong> 确保词根库已正确加载</li>
                    <li><strong>步骤 2：</strong> 上传待翻译的Excel文件（A列为待翻译的中文短语）或直接粘贴中文文本</li>
                    <li><strong>步骤 3：</strong> 点击"开始翻译"按钮处理文件，系统自动拆分词根并翻译</li>
                    <li><strong>步骤 4：</strong> 翻译完成后使用分页浏览结果，并下载完整Excel文件</li>
                    <li><strong>文本输入：</strong> 支持多种分隔符（逗号、分号、空格、换行）自动分割多个词条</li>
                    <li><strong>未匹配词根：</strong> 红色高亮显示的词根表示未在词根库中找到，点击可添加新词根</li>
                </ul>
            </div>
            
            <div id="validation-guide" class="instructions">
                <h3><i class="fas fa-info-circle"></i> 校验功能使用指南</h3>
                <ul>
                    <li><strong>步骤 1：</strong> 确保词根库已正确加载</li>
                    <li><strong>步骤 2：</strong> 上传要校验的Excel文件（格式如提供的模板）或直接粘贴英文文本</li>
                    <li><strong>步骤 3：</strong> 点击"开始校验"按钮进行表名和字段名校验</li>
                    <li><strong>步骤 4：</strong> 查看校验结果，并下载错误报告</li>
                    <li><strong>文本输入：</strong> 支持多种分隔符（逗号、分号、空格、换行）自动分割多个词条</li>
                    <li><strong>无效词根：</strong> 红色高亮显示的词根表示未在词根库中找到，点击可添加新词根</li>
                    <li><strong>校验规则：</strong>
                        <ul>
                            <li>表名格式：数据库.模式名.表名</li>
                            <li>模式名必须是：EDW_PROD, DDW_PROD, DM_PROD 之一</li>
                            <li>表名前缀必须匹配模式名</li>
                            <li>表名和字段名拆分后各部分必须存在于词根库中</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- 添加词根模态框 -->
    <div id="add-root-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 style="margin-bottom: 20px;"><i class="fas fa-plus-circle"></i> 添加新词根</h2>
            
            <div class="form-group">
                <label for="modal-chinese-root">中文词根：</label>
                <input type="text" id="modal-chinese-root" class="form-control" placeholder="输入中文词根">
            </div>
            
            <div class="form-group">
                <label for="modal-english-root">英文词根：</label>
                <input type="text" id="modal-english-root" class="form-control" placeholder="输入英文词根">
            </div>
            
            <div class="alert" id="modal-alert"></div>
            
            <div style="display: flex; justify-content: flex-end; gap: 15px; margin-top: 25px;">
                <button class="btn btn-warning" id="cancel-add-root">
                    <i class="fas fa-times"></i> 取消
                </button>
                <button class="btn btn-success" id="confirm-add-root">
                    <i class="fas fa-check"></i> 确认添加
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // 全局变量
        let rootDict = {};
        let addedRoots = {};
        let maxLen = 0;
        let translationResults = [];
        let currentPage = 1;
        const itemsPerPage = 20;
        let totalPages = 0;
        
        // 校验结果
        let tableValidationResults = [];
        let fieldValidationResults = [];
        
        // 当前选中的词根（用于模态框）
        let currentSelectedRoot = {
            chinese: '',
            english: '',
            type: '' // 'translation' 或 'validation'
        };
        
        // DOM元素
        const rootAlert = document.getElementById('root-alert');
        const rootProgress = document.getElementById('root-progress');
        const rootProgressBar = document.getElementById('root-progress-bar');
        const rootStats = document.getElementById('root-stats');
        const rootCount = document.getElementById('root-count');
        const maxLength = document.getElementById('max-length');
        const addedCount = document.getElementById('added-count');
        const retryRootBtn = document.getElementById('retry-root-btn');
        const rootStatus = document.getElementById('root-status');
        const rootStatusBadge = document.getElementById('root-status-badge');
        
        const translateFileInput = document.getElementById('translate-file');
        const translateBtn = document.getElementById('translate-btn');
        const translateAlert = document.getElementById('translate-alert');
        const translateProgress = document.getElementById('translate-progress');
        const translateProgressBar = document.getElementById('translate-progress-bar');
        const downloadSampleBtn = document.getElementById('download-sample');
        
        const downloadBtn = document.getElementById('download-btn');
        const resultAlert = document.getElementById('result-alert');
        const previewBody = document.getElementById('preview-body');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageInfo = document.getElementById('page-info');
        
        // 校验功能元素
        const validateFileInput = document.getElementById('validate-file');
        const validateBtn = document.getElementById('validate-btn');
        const validationAlert = document.getElementById('validation-alert');
        const validationProgress = document.getElementById('validation-progress');
        const validationProgressBar = document.getElementById('validation-progress-bar');
        const downloadValidationSampleBtn = document.getElementById('download-validation-sample');
        const downloadValidationResultsBtn = document.getElementById('download-validation-results');
        const validationResultAlert = document.getElementById('validation-result-alert');
        const tablePreviewBody = document.getElementById('table-preview-body');
        const fieldPreviewBody = document.getElementById('field-preview-body');
        
        // 文本输入相关元素
        const textInputTranslate = document.getElementById('text-input-translate');
        const processTextTranslateBtn = document.getElementById('process-text-translate');
        const clearTextTranslateBtn = document.getElementById('clear-text-translate');
        
        const textInputValidate = document.getElementById('text-input-validate');
        const processTextValidateBtn = document.getElementById('process-text-validate');
        const clearTextValidateBtn = document.getElementById('clear-text-validate');
        
        // 词根管理元素
        const chineseRootInput = document.getElementById('chinese-root');
        const englishRootInput = document.getElementById('english-root');
        const addRootBtn = document.getElementById('add-root-btn');
        const addRootAlert = document.getElementById('add-root-alert');
        const addedRootsList = document.getElementById('added-roots-list');
        const exportAddedRootsBtn = document.getElementById('export-added-roots');
        const clearAddedRootsBtn = document.getElementById('clear-added-roots');
        const importFileInput = document.getElementById('import-file');
        const importBtn = document.getElementById('import-btn');
        const importAlert = document.getElementById('import-alert');
        const exportFullRootBtn = document.getElementById('export-full-root-btn');
        
        // 统计元素
        const translatedCount = document.getElementById('translated-count');
        const unmatchedCount = document.getElementById('unmatched-count');
        const avgLength = document.getElementById('avg-length');
        const tableErrorCount = document.getElementById('table-error-count');
        const fieldErrorCount = document.getElementById('field-error-count');
        const invalidRootCount = document.getElementById('invalid-root-count');
        const resultCount = document.getElementById('result-count');
        const errorCount = document.getElementById('error-count');
        
        // 模态框元素
        const helpIcon = document.getElementById('help-icon');
        const modal = document.getElementById('help-modal');
        const closeModal = document.querySelector('.close');
        
        // 添加词根模态框元素
        const addRootModal = document.getElementById('add-root-modal');
        const modalChineseRoot = document.getElementById('modal-chinese-root');
        const modalEnglishRoot = document.getElementById('modal-english-root');
        const modalAlert = document.getElementById('modal-alert');
        const cancelAddRootBtn = document.getElementById('cancel-add-root');
        const confirmAddRootBtn = document.getElementById('confirm-add-root');
        
        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 加载本地存储中的新增词根
            loadAddedRoots();
            
            // 显示加载状态
            rootStatus.textContent = "正在搜索词根文件...";
            rootStatusBadge.innerHTML = '<i class="fas fa-circle"></i> 正在加载词根...';
            
            // 延迟执行让用户看到状态变化
            setTimeout(async () => {
                await loadRootDictionary();
            }, 1000);
            
            // 更新统计显示
            updateTranslationStats();
            updateValidationStats();
        });
        
        // 标签页切换
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                // 移除所有active类
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                
                // 添加active类到当前按钮和内容
                button.classList.add('active');
                document.getElementById(`${button.dataset.tab}-tab`).classList.add('active');
            });
        });
        
        // 模态框控制
        helpIcon.addEventListener('click', () => {
            modal.style.display = 'block';
        });
        
        closeModal.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        
        window.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
        
        // 添加词根模态框控制
        cancelAddRootBtn.addEventListener('click', () => {
            addRootModal.style.display = 'none';
        });
        
        closeModal.addEventListener('click', () => {
            modal.style.display = 'none';
        });
        
        // 自动加载词根库
        async function loadRootDictionary() {
            rootProgress.style.display = 'block';
            rootProgressBar.style.width = '30%';
            rootStats.style.display = 'none';
            rootStatus.textContent = "加载中...";
            rootStatusBadge.innerHTML = '<i class="fas fa-circle"></i> 正在加载词根...';
            
            try {
                // 尝试加载同一目录下的词根文件
                const rootFiles = await findRootDictionary();
                
                if (!rootFiles || rootFiles.length === 0) {
                    throw new Error('未找到词根库文件');
                }
                
                // 选择第一个找到的词根文件
                const rootFile = rootFiles[0];
                rootStatus.textContent = `已找到: ${rootFile.name}`;
                rootProgressBar.style.width = '60%';
                
                // 读取文件内容
                const arrayBuffer = await readFileAsArrayBuffer(rootFile);
                rootProgressBar.style.width = '80%';
                
                // 解析Excel文件
                const data = new Uint8Array(arrayBuffer);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet);
                
                rootDict = {};
                maxLen = 0;
                let count = 0;
                
                // 从第3行开始（索引2），跳过表头和说明行
                for (let i = 2; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    const keys = Object.keys(row);
                    
                    // 假设中文在第三个键（C列），英文在第四个键（D列）
                    if (keys.length >= 4) {
                        const chinese = row[keys[2]] ? row[keys[2]].toString().trim() : '';
                        const english = row[keys[3]] ? row[keys[3]].toString().trim().toUpperCase() : '';
                        
                        if (chinese && english && !rootDict[chinese]) {
                            rootDict[chinese] = english;
                            count++;
                            if (chinese.length > maxLen) {
                                maxLen = chinese.length;
                            }
                        }
                    }
                }
                
                // 合并新增词根
                Object.keys(addedRoots).forEach(chinese => {
                    if (!rootDict[chinese]) {
                        rootDict[chinese] = addedRoots[chinese];
                        count++;
                    }
                });
                
                rootProgressBar.style.width = '100%';
                setTimeout(() => {
                    rootProgress.style.display = 'none';
                    rootProgressBar.style.width = '0%';
                }, 500);
                
                // 显示统计信息
                rootStats.style.display = 'flex';
                rootCount.textContent = count;
                maxLength.textContent = maxLen;
                addedCount.textContent = Object.keys(addedRoots).length;
                rootStatus.textContent = `已加载 ${count} 个词根`;
                rootStatusBadge.className = 'root-status-badge root-status-loaded';
                rootStatusBadge.innerHTML = `<i class="fas fa-check-circle"></i> 词根库已加载 (${count}个)`;
                
                showAlert(rootAlert, `成功加载词根库，共 ${count} 个词根`, 'success');
                return true;
            } catch (error) {
                rootStatus.textContent = "未加载";
                rootStatusBadge.className = 'root-status-badge root-status-not-loaded';
                rootStatusBadge.innerHTML = '<i class="fas fa-exclamation-circle"></i> 词根库未加载';
                showAlert(rootAlert, `词根库加载失败: ${error.message}<br>请确保 root_dictionary.xlsx 或 root_dictionary.xls 文件位于工具同一目录下`, 'danger');
                rootProgress.style.display = 'none';
                rootProgressBar.style.width = '0%';
                rootStats.style.display = 'none';
                return false;
            }
        }
        
        // 加载新增词根
        function loadAddedRoots() {
            const savedRoots = localStorage.getItem('addedRoots');
            if (savedRoots) {
                addedRoots = JSON.parse(savedRoots);
                renderAddedRootsList();
            } else {
                addedRoots = {};
            }
        }
        
        // 保存新增词根
        function saveAddedRoots() {
            localStorage.setItem('addedRoots', JSON.stringify(addedRoots));
        }
        
        // 渲染新增词根列表
        function renderAddedRootsList() {
            addedRootsList.innerHTML = '';
            
            if (Object.keys(addedRoots).length === 0) {
                addedRootsList.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #888;">
                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 15px; display: block;"></i>
                        暂无新增词根
                    </div>
                `;
                return;
            }
            
            Object.keys(addedRoots).forEach(chinese => {
                const rootItem = document.createElement('div');
                rootItem.className = 'root-item added-root';
                rootItem.innerHTML = `
                    <div>
                        <span class="root-chinese">${chinese}</span> → 
                        <span class="root-english">${addedRoots[chinese]}</span>
                    </div>
                    <div class="root-actions">
                        <button class="action-btn remove-btn" data-chinese="${chinese}">删除</button>
                    </div>
                `;
                addedRootsList.appendChild(rootItem);
            });
            
            // 添加删除事件
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const chinese = e.target.dataset.chinese;
                    delete addedRoots[chinese];
                    saveAddedRoots();
                    renderAddedRootsList();
                    
                    // 重新加载词根库以更新统计
                    loadRootDictionary();
                });
            });
        }
        
        // 在目录中查找词根文件
        async function findRootDictionary() {
            return new Promise((resolve, reject) => {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.xlsx,.xls';
                fileInput.style.display = 'none';
                fileInput.multiple = true;
                
                fileInput.onchange = (e) => {
                    const files = Array.from(e.target.files);
                    const rootFiles = files.filter(file => 
                        file.name.toLowerCase().includes('root_dictionary') && 
                        (file.name.toLowerCase().endsWith('.xlsx') || file.name.toLowerCase().endsWith('.xls'))
                    );
                    
                    if (rootFiles.length > 0) {
                        resolve(rootFiles);
                    } else {
                        reject(new Error('未找到符合条件的词根文件'));
                    }
                    
                    document.body.removeChild(fileInput);
                };
                
                document.body.appendChild(fileInput);
                fileInput.click();
            });
        }
        
        // 读取文件为ArrayBuffer
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    resolve(e.target.result);
                };
                
                reader.onerror = function() {
                    reject(new Error('读取文件失败'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }
        
        // 重新加载词根库
        retryRootBtn.addEventListener('click', async () => {
            await loadRootDictionary();
        });
        
        // 下载翻译样例文件
        downloadSampleBtn.addEventListener('click', (e) => {
            e.preventDefault();
            
            // 创建样例数据
            const sampleData = [
                ['待译中文'],
                ['人工智能系统'],
                ['机器学习算法'],
                ['自然语言处理'],
                ['计算机视觉技术'],
                ['神经网络模型'],
                ['深度学习框架'],
                ['大数据分析平台'],
                ['云计算基础设施'],
                ['物联网应用场景'],
                ['区块链技术实现']
            ];
            
            // 创建工作簿
            const ws = XLSX.utils.aoa_to_sheet(sampleData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "待翻译");
            
            // 生成并下载文件
            XLSX.writeFile(wb, "待翻译样例文件.xlsx");
        });
        
        // 下载校验模板文件
        downloadValidationSampleBtn.addEventListener('click', (e) => {
            e.preventDefault();
            
            // 创建元模型sheet
            const metaModelData = [
                ['架构分类', '表名', '表中文名', '注释', '', '', '', '', '', '', '后台管理'],
                ['必填.填写说明: 下拉选择', '必填.填写说明: 最大长度为128字符(格式:数据库.用户名/模式名.表名)', '必填.填写说明: 最大长度为256字符', '非必填.填写说明:最大长度为256字符', '', '', '', '', '', '', '风险管理'],
                ['数据中台/EDW层', 'CNCT_E3BASE.EDW_PROD.T_EDW_EVT_ASSM_RKCT_CHK_RSLT', '资管业务风控检查结果表', '资管业务风控检查结果表', '', '', '', '', '', '', '经营管理/数据填报平台'],
                ['数据中台/DDW层', 'CNCT_E3BASE.DDW_PROD.T_DDW_ASSM_F00_RKCT_CHK_RSLT', '资管业务风控检查结果表', '资管业务风控检查结果表', '', '', '', '', '', '', '数据集市/财务BI'],
                ['数据中台/DDW层', 'CNCT_E3BASE.DDW_PROD.T_DDW_ASSM_F00_AST_UNIT_INFO', '资管业务资产单元信息表', '资管业务资产单元信息表', '', '', '', '', '', '', '数据集市/经纪集市']
            ];
            
            // 创建模型字段sheet
            const modelFieldsData = [
                ['表名', '字段英文名', '字段中文名', '类型', '长度', '精度', '主键', '外键', '不可空', '索引', '安全级别', '注释'],
                ['必填.填写说明:填写字段对应的表名', '必填.填写说明:最大长度为64字符', '必填.填写说明:最大长度为64字符', '必选.填写说明: 下拉选择，不可编辑', '必填.只能输入数字', '非必填.只能输入数字', '非必选填写说明: 下拉选择，默认否', '非必选.填写说明: 下拉选择，默认否', '非必选.填写说明: 下拉选择，默认否', '非必选.填写说明: 下拉选择，默认否', '非必选.填写说明: 下拉选择', '非必填.填写说明:最大长度为128字符'],
                ['CNCT_E3BASE.EDW_PROD.T_EDW_EVT_ASSM_RKCT_CHK_RSLT', 'SRC_SYS_NO', '源系统编号', 'string', '0', '', '', '', '', '', '', ''],
                ['CNCT_E3BASE.EDW_PROD.T_EDW_EVT_ASSM_RKCT_CHK_RSLT', 'BUS_GROUP', '业务线', 'string', '0', '', '', '', '', '', '', ''],
                ['CNCT_E3BASE.EDW_PROd.T_EDW_EVT_ASSM_RKCT_CHK_RSLT', 'JOUR_ONUM', '流水序号', 'string', '0', '', '', '', '', '', '', '']
            ];
            
            // 创建工作簿
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(metaModelData), "元模型");
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(modelFieldsData), "模型字段");
            
            // 生成并下载文件
            XLSX.writeFile(wb, "词根校验模板文件.xlsx");
        });
        
        // 添加词根
        addRootBtn.addEventListener('click', () => {
            const chinese = chineseRootInput.value.trim();
            const english = englishRootInput.value.trim().toUpperCase();
            
            if (!chinese || !english) {
                showAlert(addRootAlert, '请填写完整的中文和英文词根', 'danger');
                return;
            }
            
            // 检查词根是否已存在
            if (rootDict[chinese]) {
                showAlert(addRootAlert, `词根 "${chinese}" 已存在，无法重复添加`, 'danger');
                return;
            }
            
            // 添加到新增词根
            addedRoots[chinese] = english;
            saveAddedRoots();
            renderAddedRootsList();
            
            // 更新词根库
            rootDict[chinese] = english;
            
            // 更新统计信息
            rootCount.textContent = Object.keys(rootDict).length;
            addedCount.textContent = Object.keys(addedRoots).length;
            
            // 清空输入框
            chineseRootInput.value = '';
            englishRootInput.value = '';
            
            showAlert(addRootAlert, `成功添加新词根: ${chinese} → ${english}`, 'success');
        });
        
        // 清空新增词根
        clearAddedRootsBtn.addEventListener('click', () => {
            if (Object.keys(addedRoots).length === 0) {
                showAlert(addRootAlert, '没有可清空的新增词根', 'info');
                return;
            }
            
            if (confirm('确定要清空所有新增词根吗？此操作不可撤销。')) {
                addedRoots = {};
                saveAddedRoots();
                renderAddedRootsList();
                
                // 重新加载词根库以更新统计
                loadRootDictionary();
                
                showAlert(addRootAlert, '已清空所有新增词根', 'success');
            }
        });
        
        // 导出新增词根
        exportAddedRootsBtn.addEventListener('click', () => {
            if (Object.keys(addedRoots).length === 0) {
                showAlert(addRootAlert, '没有可导出的新增词根', 'info');
                return;
            }
            
            // 创建工作表数据
            const wsData = [
                ['中文词根', '英文词根']
            ];
            
            Object.keys(addedRoots).forEach(chinese => {
                wsData.push([chinese, addedRoots[chinese]]);
            });
            
            // 创建工作表
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // 创建工作簿并添加工作表
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "新增词根");
            
            // 生成并下载文件
            XLSX.writeFile(wb, "新增词根库.xlsx");
            showAlert(addRootAlert, '新增词根已导出', 'success');
        });
        
        // 导出完整词根库
        exportFullRootBtn.addEventListener('click', () => {
            if (Object.keys(rootDict).length === 0) {
                showAlert(importAlert, '词根库为空，无法导出', 'danger');
                return;
            }
            
            // 创建工作表数据
            const wsData = [
                ['中文词根', '英文词根']
            ];
            
            Object.keys(rootDict).forEach(chinese => {
                wsData.push([chinese, rootDict[chinese]]);
            });
            
            // 创建工作表
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // 创建工作簿并添加工作表
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "完整词根库");
            
            // 生成并下载文件
            XLSX.writeFile(wb, "完整词根库.xlsx");
            showAlert(importAlert, '完整词根库已导出', 'success');
        });
        
        // 导入词根库
        importBtn.addEventListener('click', async () => {
            if (!importFileInput.files.length) {
                showAlert(importAlert, '请选择要导入的词根库文件', 'danger');
                return;
            }
            
            const file = importFileInput.files[0];
            
            try {
                const data = await readExcelFile(file);
                const sheet = data.Sheets[data.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet);
                
                let importedCount = 0;
                let skippedCount = 0;
                
                jsonData.forEach(row => {
                    const chinese = row['中文词根'] ? row['中文词根'].toString().trim() : '';
                    const english = row['英文词根'] ? row['英文词根'].toString().trim().toUpperCase() : '';
                    
                    if (chinese && english) {
                        if (!rootDict[chinese]) {
                            // 添加到新增词根
                            addedRoots[chinese] = english;
                            importedCount++;
                        } else {
                            skippedCount++;
                        }
                    }
                });
                
                // 保存并更新
                saveAddedRoots();
                renderAddedRootsList();
                
                // 重新加载词根库以更新统计
                loadRootDictionary();
                
                showAlert(importAlert, `成功导入 ${importedCount} 个词根，跳过 ${skippedCount} 个已存在词根`, 'success');
            } catch (error) {
                showAlert(importAlert, `导入失败: ${error.message}`, 'danger');
            }
        });
        
        // 翻译文件
        translateBtn.addEventListener('click', async () => {
            if (Object.keys(rootDict).length === 0) {
                showAlert(translateAlert, '词根库未加载，请确保词根库文件存在', 'danger');
                return;
            }
            
            if (!translateFileInput.files.length) {
                showAlert(translateAlert, '请选择要翻译的文件', 'danger');
                return;
            }
            
            const file = translateFileInput.files[0];
            translateProgress.style.display = 'block';
            translateProgressBar.style.width = '30%';
            
            try {
                const data = await readExcelFile(file);
                translateProgressBar.style.width = '60%';
                
                const sheet = data.Sheets[data.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });
                
                // 处理数据（假设第一行是表头）
                translationResults = [];
                for (let i = 1; i < jsonData.length; i++) {
                    const row = jsonData[i];
                    if (row && row.length > 0) {
                        const inputPhrase = row[0].toString().trim();
                        if (inputPhrase) {
                            const [chineseTokens, englishTokens] = convertPhrase(inputPhrase);
                            translationResults.push({
                                original: inputPhrase,
                                chineseTokens: chineseTokens,
                                englishTokens: englishTokens
                            });
                        }
                    }
                }
                
                translateProgressBar.style.width = '100%';
                setTimeout(() => {
                    translateProgress.style.display = 'none';
                    translateProgressBar.style.width = '0%';
                }, 500);
                
                // 计算分页
                totalPages = Math.ceil(translationResults.length / itemsPerPage);
                currentPage = 1;
                updatePagination();
                
                // 更新统计信息
                updateTranslationStats();
                
                // 显示预览
                renderPage();
                downloadBtn.disabled = false;
                showAlert(resultAlert, `翻译完成，共处理 ${translationResults.length} 条数据`, 'success');
            } catch (error) {
                showAlert(translateAlert, `翻译失败: ${error.message}`, 'danger');
                translateProgress.style.display = 'none';
                translateProgressBar.style.width = '0%';
            }
        });
        
        // 更新翻译统计信息
        function updateTranslationStats() {
            translatedCount.textContent = translationResults.length;
            
            // 计算未匹配词根数量
            let unmatched = 0;
            let totalTokens = 0;
            
            translationResults.forEach(result => {
                result.chineseTokens.forEach(token => {
                    totalTokens++;
                    if (!rootDict[token]) {
                        unmatched++;
                    }
                });
            });
            
            unmatchedCount.textContent = unmatched;
            avgLength.textContent = totalTokens > 0 ? (totalTokens / translationResults.length).toFixed(1) : '0';
            resultCount.textContent = translationResults.length;
        }
        
        // 处理文本翻译
        processTextTranslateBtn.addEventListener('click', () => {
            if (Object.keys(rootDict).length === 0) {
                showAlert(translateAlert, '词根库未加载，请确保词根库文件存在', 'danger');
                return;
            }
            
            const inputText = textInputTranslate.value.trim();
            if (!inputText) {
                showAlert(translateAlert, '请输入要翻译的中文内容', 'danger');
                return;
            }
            
            // 使用正则表达式分割输入文本（支持逗号、分号、空格、换行）
            const phrases = inputText.split(/[,，;；\s\n]+/).filter(p => p.trim());
            
            if (phrases.length === 0) {
                showAlert(translateAlert, '未检测到有效的中文内容', 'danger');
                return;
            }
            
            // 处理每个短语
            translationResults = [];
            phrases.forEach(phrase => {
                if (phrase) {
                    const [chineseTokens, englishTokens] = convertPhrase(phrase);
                    translationResults.push({
                        original: phrase,
                        chineseTokens: chineseTokens,
                        englishTokens: englishTokens
                    });
                }
            });
            
            // 计算分页
            totalPages = Math.ceil(translationResults.length / itemsPerPage);
            currentPage = 1;
            updatePagination();
            
            // 更新统计信息
            updateTranslationStats();
            
            // 显示预览
            renderPage();
            downloadBtn.disabled = false;
            showAlert(resultAlert, `翻译完成，共处理 ${translationResults.length} 条数据`, 'success');
        });
        
        // 清空翻译文本
        clearTextTranslateBtn.addEventListener('click', () => {
            textInputTranslate.value = '';
        });
        
        // 校验文件
        validateBtn.addEventListener('click', async () => {
            if (Object.keys(rootDict).length === 0) {
                showAlert(validationAlert, '词根库未加载，请先加载词根库', 'danger');
                return;
            }
            
            if (!validateFileInput.files.length) {
                showAlert(validationAlert, '请选择要校验的文件', 'danger');
                return;
            }
            
            const file = validateFileInput.files[0];
            validationProgress.style.display = 'block';
            validationProgressBar.style.width = '30%';
            
            try {
                const data = await readExcelFile(file);
                validationProgressBar.style.width = '60%';
                
                // 重置校验结果
                tableValidationResults = [];
                fieldValidationResults = [];
                
                // 获取词根库中的所有英文词根（大写）
                const englishRoots = new Set(Object.values(rootDict).map(root => root.toUpperCase()));
                
                // 处理第一个sheet（元模型） - 表名校验
                const metaModelSheet = data.Sheets[data.SheetNames[0]];
                const metaModelData = XLSX.utils.sheet_to_json(metaModelSheet, { header: 1 });
                
                // 从第3行开始（索引2）
                for (let i = 2; i < metaModelData.length; i++) {
                    const row = metaModelData[i];
                    if (row && row.length >= 2) {
                        const fullTableName = row[1] ? row[1].toString().trim() : '';
                        if (fullTableName) {
                            validateTableName(fullTableName, englishRoots);
                        }
                    }
                }
                
                // 处理第二个sheet（模型字段） - 字段名校验
                const modelFieldsSheet = data.Sheets[data.SheetNames[1]];
                const modelFieldsData = XLSX.utils.sheet_to_json(modelFieldsSheet, { header: 1 });
                
                // 从第3行开始（索引2）
                for (let i = 2; i < modelFieldsData.length; i++) {
                    const row = modelFieldsData[i];
                    if (row && row.length >= 2) {
                        const tableName = row[0] ? row[0].toString().trim() : '';
                        const fieldName = row[1] ? row[1].toString().trim() : '';
                        
                        if (tableName && fieldName) {
                            validateFieldName(tableName, fieldName, englishRoots);
                        }
                    }
                }
                
                validationProgressBar.style.width = '100%';
                setTimeout(() => {
                    validationProgress.style.display = 'none';
                    validationProgressBar.style.width = '0%';
                }, 500);
                
                // 显示校验结果
                renderValidationResults();
                downloadValidationResultsBtn.disabled = false;
                
                // 更新统计信息
                updateValidationStats();
                
                const errorCount = tableValidationResults.length + fieldValidationResults.length;
                if (errorCount === 0) {
                    showAlert(validationResultAlert, '校验完成，未发现错误', 'success');
                } else {
                    showAlert(validationResultAlert, `校验完成，发现 ${errorCount} 个错误`, 'danger');
                }
            } catch (error) {
                showAlert(validationAlert, `校验失败: ${error.message}`, 'danger');
                validationProgress.style.display = 'none';
                validationProgressBar.style.width = '0%';
            }
        });
        
        // 更新校验统计信息
        function updateValidationStats() {
            tableErrorCount.textContent = tableValidationResults.length;
            fieldErrorCount.textContent = fieldValidationResults.length;
            
            // 计算无效词根总数
            let invalidRoots = 0;
            
            tableValidationResults.forEach(result => {
                invalidRoots += result.invalidRoots.length;
            });
            
            fieldValidationResults.forEach(result => {
                invalidRoots += result.invalidRoots.length;
            });
            
            invalidRootCount.textContent = invalidRoots;
            errorCount.textContent = tableValidationResults.length + fieldValidationResults.length;
        }
        
        // 处理文本校验
        processTextValidateBtn.addEventListener('click', () => {
            if (Object.keys(rootDict).length === 0) {
                showAlert(validationAlert, '词根库未加载，请确保词根库文件存在', 'danger');
                return;
            }
            
            const inputText = textInputValidate.value.trim();
            if (!inputText) {
                showAlert(validationAlert, '请输入要校验的英文内容', 'danger');
                return;
            }
            
            // 使用正则表达式分割输入文本（支持逗号、分号、空格、换行）
            const items = inputText.split(/[,，;；\s\n]+/).filter(i => i.trim());
            
            if (items.length === 0) {
                showAlert(validationAlert, '未检测到有效的英文内容', 'danger');
                return;
            }
            
            // 获取词根库中的所有英文词根（大写）
            const englishRoots = new Set(Object.values(rootDict).map(root => root.toUpperCase()));
            
            // 重置校验结果
            tableValidationResults = [];
            fieldValidationResults = [];
            
            // 处理每个项目
            items.forEach(item => {
                // 尝试判断是表名还是字段名
                if (item.includes('.')) {
                    // 可能是表名
                    validateTableName(item, englishRoots);
                } else {
                    // 可能是字段名
                    validateFieldName('', item, englishRoots);
                }
            });
            
            // 显示校验结果
            renderValidationResults();
            downloadValidationResultsBtn.disabled = false;
            
            // 更新统计信息
            updateValidationStats();
            
            const errorCount = tableValidationResults.length + fieldValidationResults.length;
            if (errorCount === 0) {
                showAlert(validationResultAlert, '校验完成，未发现错误', 'success');
            } else {
                showAlert(validationResultAlert, `校验完成，发现 ${errorCount} 个错误`, 'danger');
            }
        });
        
        // 清空校验文本
        clearTextValidateBtn.addEventListener('click', () => {
            textInputValidate.value = '';
        });
        
        // 表名校验逻辑
        function validateTableName(fullTableName, englishRoots) {
            // 错误信息
            let errorReason = '';
            let invalidRoots = [];
            
            // 分割表名：数据库.模式名.表名
            const parts = fullTableName.split('.');
            if (parts.length !== 3) {
                tableValidationResults.push({
                    tableName: fullTableName,
                    schema: '',
                    errorReason: '表名格式错误，应为: 数据库.模式名.表名',
                    invalidRoots: []
                });
                return;
            }
            
            const [database, schema, table] = parts;
            const validSchemas = ['EDW_PROD', 'DDW_PROD', 'DM_PROD'];
            const schemaPrefixMap = {
                'EDW_PROD': 'T_EDW_',
                'DDW_PROD': 'T_DDW_',
                'DM_PROD': 'T_DM_'
            };
            
            // 检查模式名是否有效
            if (!validSchemas.includes(schema)) {
                errorReason = `无效的模式名: ${schema}，应为: ${validSchemas.join(', ')}`;
            }
            
            // 检查表名前缀是否匹配模式名
            const expectedPrefix = schemaPrefixMap[schema];
            if (expectedPrefix && !table.startsWith(expectedPrefix)) {
                errorReason = `表名前缀错误: 应为 ${expectedPrefix}`;
            }
            
            // 提取表名主体（去除前缀）
            let tableBody = expectedPrefix ? table.substring(expectedPrefix.length) : table;
            
            // 去除后缀 _Q 或 _L
            if (tableBody.endsWith('_Q') || tableBody.endsWith('_L')) {
                tableBody = tableBody.slice(0, -2);
            }
			
            // 拆分表名主体并校验每个部分
            const tableParts = tableBody.split('_');
            const invalidParts = [];
            
            for (const part of tableParts) {
                if (part && !englishRoots.has(part.toUpperCase())) {
                    invalidParts.push(part);
                }
            }
            
            if (invalidParts.length > 0) {
                errorReason = errorReason ? `${errorReason}, 存在无效词根` : '存在无效词根';
                invalidRoots = invalidParts;
            }
            
            // 如果有错误，记录结果
            if (errorReason) {
                tableValidationResults.push({
                    tableName: fullTableName,
                    schema: schema,
                    errorReason: errorReason,
                    invalidRoots: invalidRoots
                });
            }
        }
        
        // 字段名校验逻辑
        function validateFieldName(tableName, fieldName, englishRoots) {
            // 拆分字段名
            const fieldParts = fieldName.split('_');
            const invalidParts = [];
            
            for (const part of fieldParts) {
                if (part && !englishRoots.has(part.toUpperCase())) {
                    invalidParts.push(part);
                }
            }
            
            // 如果有无效部分，记录结果
            if (invalidParts.length > 0) {
                fieldValidationResults.push({
                    tableName: tableName,
                    fieldName: fieldName,
                    errorType: '存在无效词根',
                    invalidRoots: invalidParts
                });
            }
        }
        
        // 渲染校验结果
        function renderValidationResults() {
            // 渲染表名检测结果
            tablePreviewBody.innerHTML = '';
            if (tableValidationResults.length === 0) {
                tablePreviewBody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: #888; font-size: 1.1rem;">
                            未发现表名校验错误
                        </td>
                    </tr>
                `;
            } else {
                tableValidationResults.forEach(result => {
                    const row = document.createElement('tr');
                    row.className = 'error-row';
                    
                    // 渲染无效词根为可点击元素
                    const invalidRootsHTML = result.invalidRoots.map(root => 
                        `<span class="invalid-root" data-root="${root}">${root}</span>`
                    ).join(', ');
                    
                    row.innerHTML = `
                        <td class="error-cell">${result.tableName}</td>
                        <td>${result.schema}</td>
                        <td class="error-cell">${result.errorReason}</td>
                        <td class="error-cell">${invalidRootsHTML}</td>
                    `;
                    tablePreviewBody.appendChild(row);
                });
            }
            
            // 添加无效词根点击事件
            document.querySelectorAll('.invalid-root').forEach(element => {
                element.addEventListener('click', (e) => {
                    const root = e.target.dataset.root;
                    currentSelectedRoot = {
                        chinese: '',
                        english: root,
                        type: 'validation'
                    };
                    modalChineseRoot.value = '';
                    modalEnglishRoot.value = root;
                    addRootModal.style.display = 'block';
                });
            });
            
            // 渲染字段检测结果
            fieldPreviewBody.innerHTML = '';
            if (fieldValidationResults.length === 0) {
                fieldPreviewBody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: #888; font-size: 1.1rem;">
                            未发现字段名校验错误
                        </td>
                    </tr>
                `;
            } else {
                fieldValidationResults.forEach(result => {
                    const row = document.createElement('tr');
                    row.className = 'error-row';
                    
                    // 渲染无效词根为可点击元素
                    const invalidRootsHTML = result.invalidRoots.map(root => 
                        `<span class="invalid-root" data-root="${root}">${root}</span>`
                    ).join(', ');
                    
                    row.innerHTML = `
                        <td>${result.tableName}</td>
                        <td class="error-cell">${result.fieldName}</td>
                        <td class="error-cell">${result.errorType}</td>
                        <td class="error-cell">${invalidRootsHTML}</td>
                    `;
                    fieldPreviewBody.appendChild(row);
                });
            }
            
            // 添加字段无效词根点击事件
            document.querySelectorAll('.invalid-root').forEach(element => {
                element.addEventListener('click', (e) => {
                    const root = e.target.dataset.root;
                    currentSelectedRoot = {
                        chinese: '',
                        english: root,
                        type: 'validation'
                    };
                    modalChineseRoot.value = '';
                    modalEnglishRoot.value = root;
                    addRootModal.style.display = 'block';
                });
            });
        }
        
        // 下载校验结果
        downloadValidationResultsBtn.addEventListener('click', () => {
            if (tableValidationResults.length === 0 && fieldValidationResults.length === 0) {
                showAlert(validationResultAlert, '没有可下载的校验结果', 'info');
                return;
            }
            
            // 创建工作表数据 - 表名检测结果
            const tableResultsData = [
                ['表名', '模式名', '错误原因', '无效词根']
            ];
            
            tableValidationResults.forEach(result => {
                tableResultsData.push([
                    result.tableName,
                    result.schema,
                    result.errorReason,
                    result.invalidRoots.join(', ')
                ]);
            });
            
            // 创建工作表数据 - 字段检测结果
            const fieldResultsData = [
                ['表名', '字段名', '错误类型', '无效词根']
            ];
            
            fieldValidationResults.forEach(result => {
                fieldResultsData.push([
                    result.tableName,
                    result.fieldName,
                    result.errorType,
                    result.invalidRoots.join(', ')
                ]);
            });
            
            // 创建工作簿
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(tableResultsData), "表名检测结果");
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(fieldResultsData), "字段检测结果");
            
            // 生成并下载文件
            XLSX.writeFile(wb, "词根校验结果报告.xlsx");
            showAlert(validationResultAlert, '校验结果已保存到工具所在目录', 'success');
        });
        
        // 分页按钮事件
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderPage();
                updatePagination();
            }
        });
        
        nextPageBtn.addEventListener('click', () => {
            if (currentPage < totalPages) {
                currentPage++;
                renderPage();
                updatePagination();
            }
        });
        
        // 下载翻译结果
        downloadBtn.addEventListener('click', () => {
            if (translationResults.length === 0) {
                showAlert(resultAlert, '没有可下载的结果', 'danger');
                return;
            }
            
            // 创建工作表数据
            const wsData = [
                ['原始中文', '拆分后中文', '英文转换']
            ];
            
            translationResults.forEach(result => {
                wsData.push([
                    result.original,
                    result.chineseTokens.join('_'),
                    result.englishTokens.join('_').toUpperCase()
                ]);
            });
            
            // 创建工作表
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            
            // 创建工作簿并添加工作表
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "翻译结果");
            
            // 生成并下载文件 - 保存到工具所在目录
            XLSX.writeFile(wb, "词根翻译结果.xlsx");
            showAlert(resultAlert, '结果已保存到工具所在目录', 'success');
        });
        
        // 辅助函数：显示提示信息
        function showAlert(element, message, type) {
            element.innerHTML = message;
            element.className = 'alert';
            element.classList.add(`alert-${type}`);
            element.style.display = 'block';
            
            // 5秒后自动隐藏
            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
        
        // 辅助函数：读取Excel文件
        function readExcelFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        resolve(workbook);
                    } catch (error) {
                        reject(error);
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error('读取文件失败'));
                };
                
                reader.readAsArrayBuffer(file);
            });
        }
        
        // 辅助函数：转换短语
        function convertPhrase(inputStr) {
			// 新增：去除所有非中文字符（只保留中文）
			inputStr = inputStr.replace(/[^a-zA-Z0-9\u4e00-\u9fa5]/g, '');
			
            // 1. 中文分词（最大正向匹配）
            const tokens = [];
            let i = 0;
            const n = inputStr.length;
            
            while (i < n) {
                let matched = false;
                
                // 尝试从最长词开始匹配
                for (let length = Math.min(maxLen, n - i); length > 0; length--) {
                    const word = inputStr.substring(i, i + length);
                    if (rootDict[word]) {
                        tokens.push(word);
                        i += length;
                        matched = true;
                        break;
                    }
                }
                
                // 未匹配到词根时按单字处理
                if (!matched) {
                    tokens.push(inputStr[i]);
                    i += 1;
                }
            }
            
            // 2. 转换英文并处理未匹配词
            const englishTokens = tokens.map(token => {
                return rootDict[token] || token;
            });
            
            return [tokens, englishTokens];
        }
        
        // 辅助函数：渲染当前页
        function renderPage() {
            previewBody.innerHTML = '';
            
            if (translationResults.length === 0) {
                previewBody.innerHTML = `
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 50px; color: #888; font-size: 1.2rem;">
                            <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
                            暂无翻译结果，请先上传文件或输入文本
                        </td>
                    </tr>
                `;
                return;
            }
            
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, translationResults.length);
            
            for (let i = startIndex; i < endIndex; i++) {
                const result = translationResults[i];
                const row = document.createElement('tr');
                
                // 高亮未匹配的词根
                const chineseTokensHTML = result.chineseTokens.map(token => {
                    if (rootDict[token]) {
                        return token;
                    } else {
                        return `<span class="unmatched-root" data-token="${token}">${token}</span>`;
                    }
                }).join('_');
                
                row.innerHTML = `
                    <td>${result.original}</td>
                    <td>${chineseTokensHTML}</td>
                    <td>${result.englishTokens.join('_').toUpperCase()}</td>
                `;
                previewBody.appendChild(row);
            }
            
            // 添加未匹配词根点击事件
            document.querySelectorAll('.unmatched-root').forEach(element => {
                element.addEventListener('click', (e) => {
                    const token = e.target.dataset.token;
                    currentSelectedRoot = {
                        chinese: token,
                        english: '',
                        type: 'translation'
                    };
                    modalChineseRoot.value = token;
                    modalEnglishRoot.value = '';
                    addRootModal.style.display = 'block';
                });
            });
        }
        
        // 辅助函数：更新分页状态
        function updatePagination() {
            pageInfo.textContent = `第 ${currentPage} 页 / 共 ${totalPages} 页`;
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;
        }
        
        // 添加词根确认按钮事件
        confirmAddRootBtn.addEventListener('click', () => {
            const chinese = modalChineseRoot.value.trim();
            const english = modalEnglishRoot.value.trim().toUpperCase();
            
            if (!chinese || !english) {
                showAlert(modalAlert, '请填写完整的中文和英文词根', 'danger');
                return;
            }
            
            // 检查词根是否已存在
            if (rootDict[chinese]) {
                showAlert(modalAlert, `词根 "${chinese}" 已存在，无法重复添加`, 'danger');
                return;
            }
            
            // 添加到新增词根
            addedRoots[chinese] = english;
            saveAddedRoots();
            renderAddedRootsList();
            
            // 更新词根库
            rootDict[chinese] = english;
            
            // 更新统计信息
            rootCount.textContent = Object.keys(rootDict).length;
            addedCount.textContent = Object.keys(addedRoots).length;
            
            // 关闭模态框
            addRootModal.style.display = 'none';
            showAlert(modalAlert, ``, 'success'); // 清空提示
            
            // 根据来源重新处理内容
            if (currentSelectedRoot.type === 'translation') {
                // 重新渲染翻译结果
                renderPage();
                updateTranslationStats();
            } else if (currentSelectedRoot.type === 'validation') {
                // 重新渲染校验结果
                renderValidationResults();
                updateValidationStats();
            }
            
            // 更新状态徽章
            rootStatusBadge.innerHTML = `<i class="fas fa-check-circle"></i> 词根库已加载 (${Object.keys(rootDict).length}个)`;
            
            showAlert(addRootAlert, `成功添加新词根: ${chinese} → ${english}`, 'success');
        });
    </script>
</body>
</html>
